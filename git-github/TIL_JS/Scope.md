# 스코프란?

* **모든 식별자는 자신이 선언된 위치에 의해 다른 코드가 자신을 참조할 수 있는 유요 범위가 결정된다. 이것을 스코프(Scope, 유효범위)라 한다.**

* 프로그래밍 언어는 변수를 선언, 참조, 할당하며 이것으로 프로그램의 상태(state)를 관리한다.

  > 비순수 함수: 함수 내부의 상태만이 아니라 함수 외부 상태까지 변경하는 함수를 비순수 함수(ipmure function)라고 한다. 함수가 외부 상태를 변경하면 상태 변화를 추적하기 어려워지므로 순수 함수(pure function)를 사용하는 것이 좋다.

  ```
  var x = 'global';
  
  function foo() {
    var x = 'local';
    console.log(x); // ①
  }
  
  foo();
  
  console.log(x); // ②
  ```

* 1, 2에서 변수 x를 참조하는데 두개의 변수중에서 어떤것을 참조해야하는지 결정해야 한다.

  * 스코프를 통해 결정한다. 스코프란 식별자를 검색할때 사용하는 규칙.

* 자바스크립트 엔진은 코드를 실행할 때, 코드의 문맥(Context)를 고려한다.

  > 코드의 문맥(Context)과 환경(Environment)
  >
  > 코드가 어디서 실행되고 주변에 어떤 코드들이 있는지 를 환경(Environment)이라고 부른다. 코드의 문맥(Context)은 환경으로 이루어진다. 이를 구현한 것이 실행 컨텍스트(Execution context)이며 모든 코드는 실행 컨텍스트에서 평가되고 실행된다.

* 함수 foo 내부에서 선언된 변수 x는 외부에서 참조할 수 없다. 유효한 범위(스코프)는 함수 내부까지다.

* 스코프는 식별자인 변수 이름의 충돌을 방지하여 같은 이름의 변수를 사용할 수 있도록 해준다.

  * 스코프 내에선 식별자가 유일해야 하지만 다른 스코프에는 같은 이름을 사용할 수 있다.
  * var 로 선언됨 변수는 같은 스코프 내에서 중복 선언이 허용된다. 이는 의도치 않게 변수값이 변경되는 부작용을 발생시킨다.
  * let이나 const로 선언된 변수는 같은 스코프내에 중복을 허용하지않는다.



## 스코프의 종류

코드는 전역(global)과 지역(local)로 구분할 수 있다.

| 구분 | 설명                  | 스코프      | 변수      |
| ---- | --------------------- | ----------- | --------- |
| 전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역 | 함수 몸체 내부        | 지역 스코프 | 지역 변수 |



#### 전역과 전역 스코프

![img](https://poiemaweb.com/assets/fs-images/12-2.png)

* 전역 변수는 어디서든지 참조할 수 있다.



#### 지역과 지역 스코프(local scope)

* 지역은 함수 몸체 내부를 말한다.
* 지역은 지역 스코프를 만들며 변수를 선언하면 지역 변수(local variable)가된다.
* 지역 변수는 자신이 선언된 지역과 하위지역(중첩함수) 에서만 참조할 수 있다.
* **지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효하다.**



## 스코프 체인(Scope chain)

* 함수 몸체 내부에서 함수가 정의한 함수를 중첩 함수(nested function)라한다.
* 중첩 함수를 포함하는 함수를 외부 함수(outer function)라고 부른다.
* 함수가 중첩될수있다 = 지역 스코프도 중첩될수 있다
* **스코프는 함수의 중첩에 의해 계층적 구조를 갖는다.**
  * 이때 외부함수의 지역 스코프를 중첩 함수의 상위 스코프라 한다.
  * 모든 스코프가 하나의 계층적 구조로 연결된 것을 **스코프 체인**이라 한다.
* 변수를 참조할 때, 스코프 체인을 통해 참조하는 코드의 스코프에서부터 시작해서 상위 스코프 방향으로 이동하며 선언된 변수를 찾는다.